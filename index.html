<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Smart AI Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    /* DARK THEME VARIABLES */
    --bg: #000000;
    --text: #ffffff;
    --muted: #a1a1aa;
    
    /* Default Accent */
    --accent: #ffffff; 
    --accent-text: #000000;
    --accent-bg: #ffffff;
    
    --card-bg: #121212;
    --input-bg: #1c1c1c;
    --btn-bg: #262626;
    --btn-text: #ffffff;
    
    --border: #333333;
    --shadow: 0 4px 12px rgba(0,0,0,0.5);
    
    --modal-bg: rgba(0,0,0,0.85);
  }

  body[data-theme="light"]{
    --bg: #f2f2f7;
    --text: #000000;
    --muted: #666666;
    
    --card-bg: #ffffff;
    --input-bg: #f2f2f7;
    --btn-bg: #e5e5ea;
    --btn-text: #000000;
    
    --border: #d1d1d6;
    --shadow: 0 4px 12px rgba(0,0,0,0.1);
    
    --modal-bg: rgba(255,255,255,0.85);
  }

  *{box-sizing:border-box;margin:0;padding:0; -webkit-tap-highlight-color: transparent;}
  
  html,body{
    min-height:100%;
    font-family:"Poppins",system-ui,-apple-system,sans-serif;
  }
  
  html { overflow-y: scroll; scroll-behavior: smooth; } 
  
  body{
    background-color: var(--bg);
    color: var(--text);
    display: flex;
    justify-content: center;
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .app{
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    padding: 20px 16px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding-bottom: 20px; /* Reduced footer space */
  }

  /* HEADER */
  header{
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }
  .brand{ display: flex; flex-direction: column; justify-content: center; }
  h1{ font-size: 1.5rem; font-weight: 700; letter-spacing: -0.5px; }
  .subtitle{ font-size: 0.85rem; color: var(--muted); margin-top: 2px; }
  
  .theme-block{ display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
  
  .pill {
    height: 32px;
    display: flex; align-items: center; justify-content: center;
    background: var(--btn-bg);
    color: var(--btn-text);
    border: 1px solid var(--border);
    padding: 0 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    cursor: pointer;
    font-weight: 500;
    transition: 0.2s;
    box-sizing: border-box;
  }
  .pill:hover { filter: brightness(1.1); }

  /* CARDS */
  .card{
    background: var(--card-bg);
    border-radius: 24px;
    padding: 20px 18px 24px 18px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    transition: background 0.3s ease;
  }
  .card-header{
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
  }
  .title-group { display: flex; flex-direction: column; }
  .card-title{ font-size: 1rem; font-weight: 600; }
  .card-sub{ font-size: 0.75rem; color: var(--muted); margin-top: 2px; line-height: 1.3; }

  /* SEARCH BAR */
  .search-box {
    position: relative; margin-bottom: 15px;
  }
  .search-input {
    width: 100%; background: var(--input-bg); border: 1px solid var(--border);
    padding: 12px 12px 12px 40px; border-radius: 14px; color: var(--text);
    font-size: 0.9rem; outline: none; transition: 0.2s;
  }
  .search-input:focus { border-color: var(--accent); }
  .search-icon {
    position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
    width: 16px; height: 16px; border: 2px solid var(--muted); border-radius: 50%;
  }
  .search-icon::after {
    content: ''; position: absolute; right: -4px; bottom: -4px; width: 6px; height: 2px;
    background: var(--muted); transform: rotate(45deg);
  }

  /* INPUTS */
  input, textarea {
    width: 100%;
    background: var(--input-bg);
    color: var(--text);
    border: 1px solid var(--border);
    padding: 12px 16px;
    border-radius: 14px;
    font-size: 0.95rem;
    outline: none;
    appearance: none; 
    transition: border 0.2s;
  }
  input:focus, textarea:focus { border-color: var(--accent); }

  /* NATIVE SELECT STYLING */
  select {
    appearance: none; -webkit-appearance: none;
    width: 100%; height: 100%;
    background-color: var(--btn-bg);
    color: var(--btn-text);
    border: 1px solid var(--border);
    padding: 0 30px 0 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-family: inherit;
    cursor: pointer;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23a1a1aa' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 14px;
    transition: 0.2s;
    outline: none;
    min-width: 80px;
    height: 38px;
  }
  select:focus { border-color: var(--accent); background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); }
  .card-header select { height: 32px; font-size: 0.75rem; width: auto; }
  .theme-block select { height: 32px; font-size: 0.75rem; }
  
  /* SWITCHES (Scientific, Clock, FD/RD) */
  .sc-switch{
    position: relative; width: 60px; height: 28px; background: var(--input-bg);
    border-radius: 20px; cursor: pointer; border: 1px solid var(--border);
    display: flex; align-items: center; padding: 2px;
  }
  .sc-knob{
    width: 22px; height: 22px; background: var(--text); border-radius: 50%;
    transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  .sc-switch.on .sc-knob{ transform: translateX(30px); background: var(--accent); }
  .sc-label{ position: absolute; right: 8px; font-size: 0.65rem; font-weight: 600; color: var(--muted); pointer-events: none; }
  
  /* Specific Switch Styles */
  #clock-switch .sc-label { right: auto; left: 8px; font-size: 0.8rem; }
  #clock-switch.on .sc-label { color: var(--accent); }

  /* MODALS */
  .modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--modal-bg); z-index: 999;
    display: none; align-items: center; justify-content: center;
    backdrop-filter: blur(8px);
  }
  .modal-overlay.show { display: flex; animation: fadeIn 0.3s ease; }
  .modal-card {
    background: var(--card-bg); width: 90%; max-width: 320px;
    padding: 24px; border-radius: 24px; border: 1px solid var(--border);
    text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  }
  .modal-card select { margin-bottom: 20px; text-align: left; }
  .info-list { text-align: left; font-size: 0.9rem; margin-bottom: 20px; line-height: 1.6; }
  
  /* TABS */
  .tab-bar {
    display: flex; gap: 8px; margin-bottom: 12px; overflow-x: auto; 
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
    -ms-overflow-style: none; scrollbar-width: none; 
  }
  .tab-bar::-webkit-scrollbar { display: none; }
  
  .tab-btn {
    background: transparent; color: var(--muted); border: none;
    padding: 8px 12px; font-size: 0.9rem; font-weight: 600; cursor: pointer;
    border-radius: 8px; transition: 0.2s; white-space: nowrap;
  }
  .tab-btn:hover { color: var(--text); background: var(--input-bg); }
  .tab-btn.active { color: var(--accent-text); background: var(--accent-bg); }
  
  .tab-content { display: none; animation: fadeIn 0.2s ease; }
  .tab-content.active { display: block; }

  /* CLOCK Styles */
  .clock-display {
    font-size: 2.5rem; font-weight: 600; text-align: center;
    font-variant-numeric: tabular-nums; letter-spacing: 1px;
    margin: 10px 0;
  }
  .clock-date {
    text-align: center; color: var(--muted); font-size: 0.9rem; margin-bottom: 10px;
  }
  .stopwatch-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
  .lap-list {
    max-height: 150px; overflow-y: auto; margin-top: 15px; 
    border-top: 1px solid var(--border); padding-top: 10px;
  }
  .lap-item {
    display: flex; justify-content: space-between; padding: 6px 0;
    font-size: 0.85rem; color: var(--muted); border-bottom: 1px solid rgba(128,128,128,0.1);
  }
  .timer-inputs { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; }
  .timer-input-group { display: flex; flex-direction: column; align-items: center; width: 60px; }
  .timer-input-group input { text-align: center; padding: 8px; font-size: 1.1rem; }
  .timer-input-group label { font-size: 0.7rem; color: var(--muted); margin-top: 4px; }

  /* CALCULATOR UI */
  .calc-display{
    background: var(--input-bg); border-radius: 16px; padding: 16px; margin-bottom: 16px; 
    text-align: right; position: relative; 
    min-height: 120px; display: flex; flex-direction: column; justify-content: flex-end;
    overflow: hidden; 
  }
  .history-label {
    position: absolute; top: 12px; left: 16px;
    font-size: 0.65rem; font-weight: 700; color: var(--accent); 
    letter-spacing: 1px; text-transform: uppercase; display: none;
  }
  .calc-history {
    position: absolute; top: 28px; left: 16px; width: 85%;
    max-height: 50px; overflow-y: auto;
    display: flex; flex-direction: column; align-items: flex-start; gap: 4px;
    pointer-events: auto; z-index: 10;
    opacity: 0; transition: opacity 0.2s;
  }
  .calc-history.show { opacity: 1; }
  .hist-item { font-size: 0.8rem; color: var(--muted); cursor: pointer; white-space: nowrap; }
  .hist-item:hover { color: var(--accent); }
  .calc-expression{ font-size: 0.9rem; color: var(--muted); min-height: 20px; word-break: break-all; margin-top: 35px;}
  .calc-result{ font-size: 2.2rem; font-weight: 500; color: var(--text); white-space: nowrap; overflow-x: auto; }
  .calc-result::-webkit-scrollbar { height:0px; }
  .calc-grid{ display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }

  .btn{
    background: var(--btn-bg); color: var(--btn-text); border: none; border-radius: 50px;
    padding: 12px 0; font-size: 1.1rem; font-weight: 500; cursor: pointer;
    transition: transform 0.1s, filter 0.2s; display: flex; align-items: center; justify-content: center;
    user-select: none;
  }
  .btn:active{ transform: scale(0.96); }
  .btn-accent{ background: var(--accent-bg); color: var(--accent-text); padding: 8px 0; font-size: 1rem; }
  .small{ font-size: 0.9rem; padding: 10px; }
  .btn.active-mode { border: 1px solid var(--accent); color: var(--accent); }
  .btn-action { margin-top: 15px; margin-bottom: 5px; width: 100%; }

  .row{ display: flex; gap: 10px; align-items: center; width: 100%; }
  .flex-1{ flex: 1; min-width: 0; }
  .field{ display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px; }
  .mini{ font-size: 0.75rem; color: var(--muted); padding-left: 4px;}
  .result-text{ margin-top: 8px; font-size: 0.95rem; font-weight: 500; line-height: 1.5; position: relative;}
  .muted-text { font-size: 0.75rem; color: var(--muted); margin-top: 4px; }
  
  .chips{ display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 5px; }
  .chip-btn{
    background: var(--btn-bg); color: var(--btn-text); border: 1px solid var(--border);
    padding: 8px 14px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; transition: 0.2s;
  }
  .chip-btn.active{ background: var(--accent-bg); color: var(--accent-text); border-color: transparent; font-weight: 600; }
  .chip-btn.hidden { display: none; }

  /* PANEL LOGIC */
  .panel{ display: none !important; animation: fadeIn 0.3s ease; }
  .panel.active{ display: block !important; }
  @keyframes fadeIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }

  /* DIVIDER */
  .divider{ 
    height: 1px; background: var(--border); margin: 16px 0 20px 0; width: 100%; opacity: 0.5;
  }

  .health-stats, .text-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
  .stat-box { 
    background: var(--input-bg); border-radius: 12px; padding: 12px; 
    display: flex; flex-direction: column; align-items: center; text-align: center; 
    border: 1px solid var(--border); position: relative;
  }
  .stat-val { font-size: 1.1rem; font-weight: 600; color: var(--accent); margin-bottom: 4px; }
  .stat-lbl { font-size: 0.7rem; color: var(--muted); }
  
  .info-icon {
    position: absolute; top: 6px; right: 8px;
    width: 14px; height: 14px; border-radius: 50%; border: 1px solid var(--muted);
    color: var(--muted); font-size: 9px; line-height: 13px; font-weight: bold;
    cursor: pointer; opacity: 0.7;
  }
  .info-icon:hover { opacity: 1; border-color: var(--accent); color: var(--accent); }

  .qr-container {
    margin-top: 0; display: none; flex-direction: column; align-items: center; justify-content: center; padding-top: 15px;
  }
  .qr-container.show { display: flex; }
  .qr-img { border-radius: 8px; border: 4px solid #fff; max-width: 180px; }
  .loading-txt { font-size: 0.8rem; color: var(--accent); margin-bottom: 10px; }
  .link-btn { text-decoration: none; font-size: 0.75rem; color: var(--muted); border-bottom: 1px dotted var(--muted); cursor: pointer; }

  /* Radio Group */
  .radio-group { display: flex; gap: 15px; margin-top: 5px; }
  .radio-label { display: flex; align-items: center; gap: 6px; font-size: 0.85rem; cursor: pointer; color: var(--text); }

  footer{ text-align: center; padding: 20px 0; color: var(--muted); font-size: 0.8rem; border-top: 1px solid var(--border); margin-top: 20px; }
  .heart { display: inline-block; color: var(--accent); animation: heartbeat 1.5s infinite; }
  @keyframes heartbeat { 0% { transform: scale(1); } 15% { transform: scale(1.3); } 30% { transform: scale(1); } 45% { transform: scale(1.3); } 60% { transform: scale(1); } 100% { transform: scale(1); } }
</style>
</head>
<body data-theme="dark">

<div id="currency-modal" class="modal-overlay">
  <div class="modal-card">
    <div class="card-title" style="margin-bottom:10px; font-size:1.2rem;">Select Currency</div>
    <div style="margin-bottom:15px; color:var(--muted); font-size:0.9rem;">Choose your preferred currency for all tools.</div>
    <select id="modal-currency-select">
      <option value="‚Çπ">‚Çπ INR</option><option value="$">$ USD</option><option value="‚Ç¨">‚Ç¨ EUR</option><option value="¬£">¬£ GBP</option><option value="¬•">¬• JPY</option>
      <option value="A$">A$ AUD</option><option value="C$">C$ CAD</option><option value="¬•">¬• CNY</option><option value="‚Ç£">‚Ç£ CHF</option><option value="NZ$">NZ$ NZD</option>
    </select>
    <button id="modal-save-btn" class="btn btn-accent" style="width:100%; margin-top:15px;">Get Started</button>
    <div style="margin-top:12px; font-size:0.75rem; color:var(--muted);">Change anytime in <b>More Tools</b>.</div>
  </div>
</div>

<div id="info-modal" class="modal-overlay">
  <div class="modal-card">
    <div id="info-title" class="card-title" style="margin-bottom:10px; font-size:1.1rem;"></div>
    <div id="info-content" class="info-list" style="color:var(--muted); font-size:0.9rem; text-align:left;"></div>
    <button id="info-close-btn" class="btn btn-accent" style="width:100%; margin-top:15px;">Got it</button>
  </div>
</div>

<div class="app">
  
  <header>
    <div class="brand">
      <h1>Smart AI Calculator</h1>
      <div class="subtitle">Minimal, fast & versatile.</div>
    </div>
    <div class="theme-block">
      <button id="toggle-theme" class="pill">Dark / Light</button>
      <select id="theme-color">
        <option value="mono" selected>Default</option>
        <option value="blue">Blue</option><option value="red">Red</option><option value="green">Green</option>
        <option value="orange">Orange</option><option value="sunset">Sunset</option><option value="ocean">Ocean</option>
      </select>
    </div>
  </header>

  <main style="display:flex; flex-direction:column; gap:20px;">
    
    <section class="card">
      <div class="card-header">
        <div class="title-group"><div class="card-title">Calculator</div><div class="card-sub">Scientific Mode & Smart History.</div></div>
        <div id="sc-switch" class="sc-switch"><span class="sc-label">SCI</span><div class="sc-knob"></div></div>
      </div>
      <div class="calc-display">
        <div id="hist-lbl" class="history-label">History</div>
        <div id="calc-history" class="calc-history"></div>
        <div id="calc-expression" class="calc-expression"></div>
        <div id="calc-result" class="calc-result">0</div>
      </div>
      <div id="calc-grid" class="calc-grid"></div>
      <div class="calc-grid" style="margin-top:10px">
        <button id="calc-clear" class="btn small" style="color:#ef4444" data-key="Escape">AC</button><button id="calc-back" class="btn small" data-key="Backspace">‚å´</button><button id="calc-copy" class="btn small">Copy</button><button id="calc-equals" class="btn btn-accent" data-key="Enter">=</button>
      </div>
      <div id="sci-keys" class="calc-grid" style="margin-top:10px; display:none;">
        <button class="btn small" id="deg-toggle" style="font-size:0.8rem">DEG</button>
        <button class="btn small" data-fn="sin">sin</button><button class="btn small" data-fn="cos">cos</button><button class="btn small" data-fn="tan">tan</button>
        <button class="btn small" data-fn="sqrt">‚àö</button><button class="btn small" data-fn="ln">ln</button><button class="btn small" data-fn="log">log</button><button class="btn small" data-fn="pow">x ∏</button><button class="btn small" data-fn="pi">œÄ</button>
        <button class="btn small" data-fn="(">(</button><button class="btn small" data-fn=")">)</button><button class="btn small" data-fn="e">e</button><button class="btn small" data-fn="inv">1/x</button>
      </div>
    </section>

    <section class="card">
      <div class="card-header"><div class="title-group"><div class="card-title">Age Calculator</div><div class="card-sub">Calculate exact age.</div></div></div>
      <div class="field"><label class="mini">Date of birth</label><input type="date" id="dob-input"></div>
      <button id="age-btn" class="btn btn-accent btn-action">Calculate Age</button>
      <div id="age-result" class="result-text"></div>
    </section>

    <section class="card">
      <div class="card-header"><div class="title-group"><div class="card-title">Currency Converter</div><div class="card-sub">Real-time rates.</div></div></div>
      <div class="row">
        <div class="field flex-1"><label class="mini">Amount</label><input id="cur-amt" type="number" placeholder="1"></div>
        <div class="field flex-1"><label class="mini">From</label><select id="cur-from"><option value="USD" selected>USD</option><option value="EUR">EUR</option><option value="INR">INR</option><option value="GBP">GBP</option><option value="JPY">JPY</option><option value="AUD">AUD</option><option value="CAD">CAD</option><option value="CNY">CNY</option><option value="CHF">CHF</option><option value="NZD">NZD</option></select></div>
        <div class="field flex-1"><label class="mini">To</label><select id="cur-to"><option value="INR" selected>INR</option><option value="USD">USD</option><option value="EUR">EUR</option><option value="GBP">GBP</option><option value="JPY">JPY</option><option value="AUD">AUD</option><option value="CAD">CAD</option><option value="CNY">CNY</option><option value="CHF">CHF</option><option value="NZD">NZD</option></select></div>
      </div>
      <div class="row">
        <button id="cur-btn" class="btn btn-accent flex-1 btn-action">Convert</button>
        <button id="cur-swap" class="btn small" style="width:50px; margin-top:10px;">‚áÑ</button>
      </div>
      <div id="cur-res" class="result-text"></div>
      <div id="cur-source" class="muted-text" style="display:none;"><span id="cur-date"></span> | <a href="https://www.frankfurter.app" target="_blank" class="link-btn">Source: Frankfurter API</a></div>
    </section>

    <section class="card">
      <div class="card-header"><div class="title-group"><div class="card-title">QR Generator</div><div class="card-sub">Create QR codes.</div></div></div>
      <div class="field"><label class="mini">Text or URL</label><input id="qr-text" type="text" placeholder="https://example.com"></div>
      <button id="qr-btn" class="btn btn-accent btn-action">Generate</button>
      <div id="qr-container" class="qr-container">
        <div id="qr-loading" class="loading-txt">Generating...</div>
        <img id="qr-image" class="qr-img" alt="QR Code" style="display:none;" />
        <a id="qr-download" class="link-btn" style="display:none; margin-top:10px;">Download</a>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <div><div class="card-title">More Tools</div><div class="card-sub">Specialized calculators.</div></div>
        <select id="global-currency" style="min-width:80px;">
            <option value="‚Çπ">‚Çπ INR</option><option value="$">$ USD</option><option value="‚Ç¨">‚Ç¨ EUR</option><option value="¬£">¬£ GBP</option><option value="¬•">¬• JPY</option>
            <option value="A$">A$ AUD</option><option value="C$">C$ CAD</option><option value="¬•">¬• CNY</option><option value="‚Ç£">‚Ç£ CHF</option><option value="NZ$">NZ$ NZD</option>
        </select>
      </div>

      <div class="search-box">
        <div class="search-icon"></div>
        <input type="text" id="tool-search" class="search-input" placeholder="Search (e.g., GST, Fuel, Sleep)...">
      </div>

      <div class="tab-bar">
        <button class="tab-btn active" data-tab="tab-finance">Finance</button>
        <button class="tab-btn" data-tab="tab-clock">Clock</button>
        <button class="tab-btn" data-tab="tab-health">Health</button>
        <button class="tab-btn" data-tab="tab-travel">Travel</button>
        <button class="tab-btn" data-tab="tab-tools">Tools</button>
      </div>

      <div id="tab-finance" class="tab-content active">
        <div class="chips">
          <button class="chip-btn active" data-panel="loan-panel">Loan/EMI</button>
          <button class="chip-btn" id="btn-tax" data-panel="gst-panel">GST</button> 
          <button class="chip-btn" id="btn-invest" data-panel="invest-panel">SIP/Invest</button>
          <button class="chip-btn" data-panel="goal-panel">Goal Planner</button>
          <button class="chip-btn" data-panel="fd-panel">FD/RD</button>
          <button class="chip-btn" data-panel="tax-panel">Income Tax</button>
          <button class="chip-btn" data-panel="inflation-panel">Inflation</button>
          <button class="chip-btn" data-panel="discount-panel">Percentage</button>
          <button class="chip-btn" data-panel="bill-panel">Split Bill</button>
          <button class="chip-btn" data-panel="ci-panel">Compound Int.</button>
        </div>
      </div>

      <div id="tab-clock" class="tab-content">
        <div class="chips">
          <button class="chip-btn" data-panel="clock-panel">Live Clock</button>
          <button class="chip-btn" data-panel="stopwatch-panel">Stopwatch</button>
          <button class="chip-btn" data-panel="timer-panel">Timer</button>
          <button class="chip-btn" data-panel="zone-panel">World Clock</button>
        </div>
      </div>

      <div id="tab-health" class="tab-content">
        <div class="chips">
          <button class="chip-btn" data-panel="health-panel">Health Station</button>
          <button class="chip-btn" data-panel="calory-panel">Calory Calc</button>
          <button class="chip-btn" data-panel="fat-panel">Body Fat %</button>
        </div>
      </div>

      <div id="tab-travel" class="tab-content">
        <div class="chips">
          <button class="chip-btn" data-panel="fuel-panel">Fuel Cost</button>
          <button class="chip-btn" data-panel="eta-panel">Trip ETA</button>
          <button class="chip-btn" data-panel="budget-panel">Travel Budget</button>
        </div>
      </div>

      <div id="tab-tools" class="tab-content">
        <div class="chips">
          <button class="chip-btn" data-panel="unit-panel">Converters</button>
          <button class="chip-btn" data-panel="time-panel">Day Counter</button>
          <button class="chip-btn" data-panel="text-panel">Text Tools</button>
          <button class="chip-btn" data-panel="base-panel">Base Converter</button>
          <button class="chip-btn" data-panel="gpa-panel">GPA</button>
        </div>
      </div>

      <div class="divider"></div>

      <div id="clock-panel" class="panel">
         <div class="title-group" style="margin-bottom:10px; text-align:center;"><div class="card-title">Live Clock</div></div>
         <div id="clock-display" class="clock-display">--:--:--</div>
         <div id="clock-date" class="clock-date">-- -- --</div>
         <div style="display:flex; justify-content:center; margin-top:10px;">
            <div id="clock-switch" class="sc-switch on"><span class="sc-label">üîä</span><div class="sc-knob"></div></div>
         </div>
      </div>

      <div id="stopwatch-panel" class="panel">
         <div class="title-group" style="margin-bottom:10px"><div class="card-title">Stopwatch</div></div>
         <div id="sw-display" class="clock-display">00:00.00</div>
         <div class="stopwatch-controls">
           <button id="sw-start" class="btn btn-accent">Start</button>
           <button id="sw-lap" class="btn" disabled>Lap</button>
         </div>
         <div id="sw-laps" class="lap-list" style="display:none;"></div>
      </div>

      <div id="timer-panel" class="panel">
         <div class="title-group" style="margin-bottom:10px"><div class="card-title">Timer</div></div>
         <div class="timer-inputs" id="timer-inputs">
            <div class="timer-input-group"><input type="number" id="t-h" placeholder="00" min="0"><label>Hr</label></div>
            <div class="timer-input-group"><input type="number" id="t-m" placeholder="00" min="0" max="59"><label>Min</label></div>
            <div class="timer-input-group"><input type="number" id="t-s" placeholder="00" min="0" max="59"><label>Sec</label></div>
         </div>
         <div id="t-display" class="clock-display" style="display:none;">00:00:00</div>
         <div class="stopwatch-controls">
           <button id="t-start" class="btn btn-accent">Start</button>
           <button id="t-reset" class="btn">Reset</button>
         </div>
      </div>

      <div id="zone-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">World Clock</div><div class="card-sub">See the current time across regions.</div></div>
        <div class="field"><label class="mini">Select Region</label>
          <select id="zone-sel">
            <option value="Asia/Kolkata">üáÆüá≥ India (IST)</option>
            <option value="America/New_York">üá∫üá∏ New York (EST)</option>
            <option value="Europe/London">üá¨üáß London (GMT)</option>
            <option value="Asia/Dubai">üá¶üá™ Dubai (GST)</option>
            <option value="Asia/Tokyo">üáØüáµ Tokyo (JST)</option>
            <option value="Australia/Sydney">üá¶üá∫ Sydney (AEDT)</option>
            <option value="America/Los_Angeles">üá∫üá∏ Los Angeles (PST)</option>
            <option value="Europe/Paris">üá´üá∑ Paris (CET)</option>
          </select>
        </div>
        <button id="zone-btn" class="btn btn-accent btn-action">Get Time</button>
        <div id="zone-res" class="result-text"></div>
      </div>

      <div id="loan-panel" class="panel active">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Loan / EMI</div><div class="card-sub">See how much you‚Äôll pay every month.</div></div>
        <div class="field"><label class="mini">Loan Amount</label><input id="emi-principal" type="number" placeholder="100000"></div>
        <div class="row">
          <div class="field flex-1"><label class="mini">Rate %</label><input id="emi-rate" type="number" step="0.1" placeholder="7.5"></div>
          <div class="field" style="width:80px"><label class="mini">Tenure</label><input id="emi-time" type="number" placeholder="5"></div>
          <div class="field" style="width:100px"><label class="mini">Period</label><select id="emi-unit"><option value="years">Years</option><option value="months">Months</option></select></div>
        </div>
        <button id="emi-calc" class="btn btn-accent btn-action">Calculate EMI</button>
        <div id="emi-result" class="result-text"></div>
      </div>

      <div id="gst-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title" id="gst-title">GST / VAT</div><div class="card-sub">Add or remove Tax from any amount.</div></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Amount</label><input id="gst-amt" type="number" placeholder="1000"></div>
           <div class="field flex-1"><label class="mini">Tax Rate %</label><input id="gst-rate" type="number" placeholder="18"></div>
        </div>
        <div class="row" style="margin-top:15px; gap:10px;">
          <button id="gst-add" class="btn flex-1" style="font-size:0.9rem">Add Tax (+)</button>
          <button id="gst-rem" class="btn flex-1" style="font-size:0.9rem">Remove Tax (-)</button>
        </div>
        <div id="gst-res" class="result-text"></div>
      </div>

      <div id="invest-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title" id="sip-title">SIP Calculator</div><div class="card-sub">See how your monthly investment grows over time.</div></div>
        <div class="field"><label class="mini">Monthly Amount</label><input id="sip-amt" type="number" placeholder="5000"></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Rate %</label><input id="sip-rate" type="number" placeholder="12"></div>
           <div class="field flex-1"><label class="mini">Years</label><input id="sip-years" type="number" placeholder="10"></div>
        </div>
        <button id="sip-btn" class="btn btn-accent btn-action">Calculate Return</button>
        <div id="sip-res" class="result-text"></div>
      </div>

      <div id="goal-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Goal Planner</div><div class="card-sub">Find how much you must invest each month to reach your goal.</div></div>
        <div class="field"><label class="mini">Target Amount</label><input id="goal-target" type="number" placeholder="10000000"></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Years</label><input id="goal-time" type="number" placeholder="10"></div>
           <div class="field flex-1"><label class="mini">Exp. Rate %</label><input id="goal-rate" type="number" placeholder="12"></div>
        </div>
        <button id="goal-btn" class="btn btn-accent btn-action">Calculate Monthly SIP</button>
        <div id="goal-res" class="result-text"></div>
      </div>

      <div id="fd-panel" class="panel">
        <div class="card-header">
           <div class="title-group"><div class="card-title" id="fd-title">Fixed Deposit</div><div class="card-sub">Calculate maturity amount.</div></div>
           <div id="fd-switch" class="sc-switch"><span class="sc-label">RD</span><div class="sc-knob"></div></div>
        </div>
        <div class="field"><label class="mini">Investment Amount</label><input id="fd-amt" type="number" placeholder="100000"></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Rate %</label><input id="fd-rate" type="number" placeholder="6.5"></div>
           <div class="field flex-1"><label class="mini">Time (Years)</label><input id="fd-time" type="number" placeholder="5"></div>
        </div>
        <button id="fd-btn" class="btn btn-accent btn-action">Calculate Maturity</button>
        <div id="fd-res" class="result-text"></div>
      </div>

      <div id="tax-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Income Tax (India)</div><div class="card-sub">Calculate tax liability.</div></div>
        <div class="field"><label class="mini">Annual Income</label><input id="tax-income" type="number" placeholder="1200000"></div>
        <div class="field">
           <label class="mini">Regime</label>
           <div class="radio-group">
             <label class="radio-label"><input type="radio" name="regime" value="new" checked> New Regime (Default)</label>
             <label class="radio-label"><input type="radio" name="regime" value="old"> Old Regime</label>
           </div>
        </div>
        <button id="tax-btn" class="btn btn-accent btn-action">Calculate Tax</button>
        <div id="tax-res" class="result-text"></div>
      </div>

      <div id="inflation-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Inflation Calculator</div><div class="card-sub">Future value of money.</div></div>
        <div class="field"><label class="mini">Current Expense</label><input id="inf-amt" type="number" placeholder="50000"></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Inflation %</label><input id="inf-rate" type="number" placeholder="6"></div>
           <div class="field flex-1"><label class="mini">Years</label><input id="inf-time" type="number" placeholder="10"></div>
        </div>
        <button id="inf-btn" class="btn btn-accent btn-action">Calculate Future Cost</button>
        <div id="inf-res" class="result-text"></div>
      </div>

      <div id="discount-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Percentage Calculator</div><div class="card-sub">Get the % value or price after discount.</div></div>
        <div class="field"><label class="mini">Total Amount</label><input id="perc-total" type="number" placeholder="2000"></div>
        <div class="field"><label class="mini">Percentage %</label><input id="perc-rate" type="number" placeholder="50"></div>
        <button id="perc-btn" class="btn btn-accent btn-action">Calculate</button>
        <div id="perc-res" class="result-text"></div>
      </div>

      <div id="bill-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Bill Splitter</div><div class="card-sub">See how much each person needs to pay.</div></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Total Bill</label><input id="bill-amt" type="number" placeholder="2500"></div>
           <div class="field flex-1"><label class="mini">Tip %</label><input id="bill-tip" type="number" placeholder="10"></div>
        </div>
        <div class="field"><label class="mini">People</label><input id="bill-ppl" type="number" placeholder="4"></div>
        <button id="bill-btn" class="btn btn-accent btn-action">Split Bill</button>
        <div id="bill-res" class="result-text"></div>
      </div>

      <div id="ci-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Compound Interest</div><div class="card-sub">See how your money grows over time.</div></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Principal</label><input id="ci-p" type="number" placeholder="10000"></div>
           <div class="field flex-1"><label class="mini">Rate %</label><input id="ci-r" type="number" placeholder="8"></div>
        </div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Years</label><input id="ci-t" type="number" placeholder="10"></div>
           <div class="field flex-1"><label class="mini">Compounded</label><select id="ci-n"><option value="1">Yearly</option><option value="4">Quarterly</option><option value="12">Monthly</option></select></div>
        </div>
        <button id="ci-btn" class="btn btn-accent btn-action">Calculate Amount</button>
        <div id="ci-res" class="result-text"></div>
      </div>

      <div id="health-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Health Station (BMI/BMR)</div><div class="card-sub">Know what your body needs to stay healthy each day.</div></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Age</label><input id="h-age" type="number" placeholder="25"></div>
           <div class="field flex-1"><label class="mini">Gender</label><select id="h-gender"><option value="male">Male</option><option value="female">Female</option></select></div>
        </div>
        <div class="row">
          <div class="field flex-1"><label class="mini">Weight (kg)</label><input id="h-weight" type="number" placeholder="70"></div>
          <div class="field flex-1"><label class="mini">Height (cm)</label><input id="h-height" type="number" placeholder="170"></div>
        </div>
        <div class="field">
          <label class="mini">Activity Level</label>
          <select id="h-activity">
            <option value="1.2">Sedentary (Little/No exercise)</option><option value="1.375">Light</option><option value="1.55">Moderate</option><option value="1.725">Active</option><option value="1.9">Very Active</option>
          </select>
        </div>
        <button id="h-btn" class="btn btn-accent btn-action">Calculate Stats</button>
        <div id="h-result" class="health-stats" style="display:none;">
          <div class="stat-box"><div class="info-icon" id="bmi-info">i</div><div id="res-bmi" class="stat-val">--</div><div class="stat-lbl">BMI Score</div></div>
          <div class="stat-box"><div id="res-bmr" class="stat-val">--</div><div class="stat-lbl">BMR (Cal/Day)</div></div>
          <div class="stat-box"><div id="res-water" class="stat-val">--</div><div class="stat-lbl">Water (L)</div></div>
          <div class="stat-box"><div id="res-protein" class="stat-val">--</div><div class="stat-lbl">Protein (g)</div></div>
        </div>
        <div id="h-msg" class="result-text" style="text-align:center;"></div>
      </div>

      <div id="calory-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Calory Calculator</div><div class="card-sub">Daily energy needs.</div></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Age</label><input id="cal-age" type="number" placeholder="25"></div>
           <div class="field flex-1"><label class="mini">Gender</label><select id="cal-gender"><option value="male">Male</option><option value="female">Female</option></select></div>
        </div>
        <div class="row">
          <div class="field flex-1"><label class="mini">Weight (kg)</label><input id="cal-weight" type="number" placeholder="70"></div>
          <div class="field flex-1"><label class="mini">Height (cm)</label><input id="cal-height" type="number" placeholder="170"></div>
        </div>
        <div class="field">
          <label class="mini">Activity</label>
          <select id="cal-activity">
            <option value="1.2">Sedentary</option><option value="1.375">Light Exercise</option>
            <option value="1.55">Moderate Exercise</option><option value="1.725">Heavy Exercise</option>
          </select>
        </div>
        <button id="cal-btn" class="btn btn-accent btn-action">Calculate Calories</button>
        <div id="cal-res" class="result-text"></div>
      </div>

      <div id="fat-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Body Fat %</div><div class="card-sub">US Navy Method.</div></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Gender</label><select id="fat-gender"><option value="male">Male</option><option value="female">Female</option></select></div>
           <div class="field flex-1"><label class="mini">Height (cm)</label><input id="fat-height" type="number" placeholder="175"></div>
        </div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Waist (cm)</label><input id="fat-waist" type="number" placeholder="85"></div>
           <div class="field flex-1"><label class="mini">Neck (cm)</label><input id="fat-neck" type="number" placeholder="38"></div>
        </div>
        <div class="field" id="fat-hip-group" style="display:none;"><label class="mini">Hip (cm)</label><input id="fat-hip" type="number" placeholder="95"></div>
        <button id="fat-btn" class="btn btn-accent btn-action">Calculate Body Fat</button>
        <div id="fat-res" class="result-text"></div>
      </div>

      <div id="fuel-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Fuel Cost Calculator</div><div class="card-sub">See how much fuel you‚Äôll need and what it will cost.</div></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Distance (km)</label><input id="fuel-dist" type="number" placeholder="300"></div>
           <div class="field flex-1"><label class="mini">Mileage (km/l)</label><input id="fuel-mil" type="number" placeholder="15"></div>
        </div>
        <div class="field"><label class="mini">Fuel Price</label><input id="fuel-price" type="number" placeholder="100"></div>
        <button id="fuel-btn" class="btn btn-accent btn-action">Calculate Cost</button>
        <div id="fuel-res" class="result-text"></div>
      </div>

      <div id="eta-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Trip ETA</div><div class="card-sub">Find out when you‚Äôll reach your destination.</div></div>
        <div class="row">
           <div class="field flex-1"><label class="mini">Distance (km)</label><input id="eta-dist" type="number" placeholder="200"></div>
           <div class="field flex-1"><label class="mini">Speed (km/h)</label><input id="eta-speed" type="number" placeholder="60"></div>
        </div>
        <div class="field"><label class="mini">Start Time</label><input id="eta-start" type="time"></div>
        <button id="eta-btn" class="btn btn-accent btn-action">Calculate Arrival</button>
        <div id="eta-res" class="result-text"></div>
      </div>

      <div id="budget-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Travel Budget</div><div class="card-sub">Estimate trip cost.</div></div>
        <div class="row"><div class="field flex-1"><label class="mini">Transport</label><input id="tb-trans" type="number" placeholder="5000"></div><div class="field flex-1"><label class="mini">Accommodation</label><input id="tb-stay" type="number" placeholder="8000"></div></div>
        <div class="row"><div class="field flex-1"><label class="mini">Food</label><input id="tb-food" type="number" placeholder="4000"></div><div class="field flex-1"><label class="mini">Activities</label><input id="tb-act" type="number" placeholder="3000"></div></div>
        <div class="field"><label class="mini">Shopping / Misc</label><input id="tb-misc" type="number" placeholder="2000"></div>
        <button id="tb-btn" class="btn btn-accent btn-action">Calculate Total</button>
        <div id="tb-res" class="result-text"></div>
      </div>

      <div id="unit-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Unit Converter</div></div>
        <div class="field"><label class="mini">Type</label><select id="u-type"><option value="length">Length</option><option value="weight">Weight</option><option value="temp">Temperature</option><option value="speed">Speed</option></select></div>
        <div class="row"><div class="field flex-1"><label class="mini">From</label><select id="u-from"></select></div><button id="u-swap" class="btn small" style="width:40px; margin-top: 18px">‚áÑ</button><div class="field flex-1"><label class="mini">To</label><select id="u-to"></select></div></div>
        <div class="field"><label class="mini">Value</label><input id="u-val" type="number" placeholder="1"></div>
        <button id="u-btn" class="btn btn-accent btn-action">Convert</button>
        <div id="u-res" class="result-text"></div>
      </div>

      <div id="text-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Text Analysis</div><div class="card-sub">Analyze and format your text instantly.</div></div>
        <div class="field"><textarea id="txt-in" rows="4" placeholder="Type or paste..."></textarea></div>
        <div class="text-stats" style="margin-bottom:10px;"><div class="stat-box"><div id="txt-words" class="stat-val">0</div><div class="stat-lbl">Words</div></div><div class="stat-box"><div id="txt-chars" class="stat-val">0</div><div class="stat-lbl">Characters</div></div></div>
        <div class="row" style="gap:5px;"><button id="txt-upper" class="btn small flex-1">UPPER</button><button id="txt-lower" class="btn small flex-1">lower</button><button id="txt-clear" class="btn small flex-1">Clear</button></div>
      </div>

      <div id="base-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Base Converter</div><div class="card-sub">Convert numbers between different numeral systems.</div></div>
        <div class="row"><div class="field flex-1"><label class="mini">Number</label><input id="base-num" type="text" placeholder="10"></div><div class="field flex-1"><label class="mini">From Base</label><select id="base-from"><option value="10">Decimal</option><option value="2">Binary</option><option value="16">Hex</option></select></div></div>
        <button id="base-btn" class="btn btn-accent btn-action">Convert</button>
        <div id="base-res" class="result-text"></div>
      </div>

      <div id="time-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">Day Counter</div><div class="card-sub">Find the number of days between two dates.</div></div>
        <div class="row"><div class="field flex-1"><label class="mini">Start</label><input id="time-start" type="date"></div><div class="field flex-1"><label class="mini">End</label><input id="time-end" type="date"></div></div>
        <button id="time-diff" class="btn btn-accent btn-action">Calculate Days</button>
        <div id="time-result" class="result-text"></div>
      </div>

      <div id="gpa-panel" class="panel">
        <div class="title-group" style="margin-bottom:10px"><div class="card-title">GPA / Average</div><div class="card-sub">Find the average of any set of numbers.</div></div>
        <div class="field"><label class="mini">Numbers (comma separated)</label><input id="gpa-in" type="text" placeholder="8.5, 9.0, 7.5"></div>
        <button id="gpa-btn" class="btn btn-accent btn-action">Calculate Average</button>
        <div id="gpa-res" class="result-text"></div>
      </div>

    </section>
  </main>

  <footer>
    Made With <span class="heart">‚ù§Ô∏è</span> By Avinash Gupta!
  </footer>
</div>
<script>
  const $ = id => document.getElementById(id);
  
  // --- 1. GLOBAL VARIABLES ---
  let expr = ''; 
  let useDeg = true; 
  let history = []; 
  let globalSym = '‚Çπ'; 

  // Clock Variables
  let clockInterval;
  let swInterval, swTime = 0, swRunning = false;
  let timerInterval, timerTime = 0, timerRunning = false;
  let isClockSoundOn = true; // Default sound ON

  // Feature Flags
  let isRD = false; // False = FD, True = RD

  // Helpers
  const formatNum = (n) => parseFloat(n.toFixed(10));
  const formatINR = (n) => new Intl.NumberFormat('en-IN', { maximumFractionDigits: 1 }).format(n);
  const pad = (n) => n.toString().padStart(2, '0');

  // --- 2. SETUP & THEME ---
  const savedCurr = localStorage.getItem('calc_currency');
  if (savedCurr) setGlobalCurrency(savedCurr); 
  else setTimeout(() => $('currency-modal').classList.add('show'), 500);

  $('modal-save-btn').onclick = () => {
      setGlobalCurrency($('modal-currency-select').value);
      $('currency-modal').classList.remove('show');
  };
  $('global-currency').onchange = (e) => setGlobalCurrency(e.target.value);

  function setGlobalCurrency(sym) {
      globalSym = sym;
      localStorage.setItem('calc_currency', sym);
      $('global-currency').value = sym;
      $('modal-currency-select').value = sym;
      
      // Update dynamic titles
      const taxBtn = $('btn-tax'), invBtn = $('btn-invest'), gstTitle = $('gst-title'), sipTitle = $('sip-title');
      if (['‚Çπ', 'A$', 'C$', 'NZ$'].includes(sym)) { taxBtn.textContent = "GST"; gstTitle.textContent = "GST Calculator"; }
      else if (['‚Ç¨', '¬£'].includes(sym)) { taxBtn.textContent = "VAT"; gstTitle.textContent = "VAT Calculator"; }
      else { taxBtn.textContent = "Tax"; gstTitle.textContent = "Tax Calculator"; }

      if (sym === '‚Çπ') { invBtn.textContent = "SIP"; sipTitle.textContent = "SIP Calculator"; }
      else { invBtn.textContent = "Invest"; sipTitle.textContent = "Investment Calc"; }
  }

  function updateThemeColors(themeName) {
    const root = document.documentElement; 
    const themes = {
        blue:   { bg: '#3b82f6', solid: '#3b82f6' },
        red:    { bg: '#ef4444', solid: '#ef4444' },
        green:  { bg: '#22c55e', solid: '#22c55e' },
        orange: { bg: '#f97316', solid: '#f97316' },
        sunset: { bg: 'linear-gradient(135deg, #f97316, #ef4444)', solid: '#ef4444' },
        ocean:  { bg: 'linear-gradient(135deg, #06b6d4, #3b82f6)', solid: '#3b82f6' }
    };
    if (themeName === 'mono') {
       const isLight = document.body.dataset.theme === 'light';
       root.style.setProperty('--accent-bg', isLight ? '#000000' : '#ffffff');
       root.style.setProperty('--accent', isLight ? '#000000' : '#ffffff');
       root.style.setProperty('--accent-text', isLight ? '#ffffff' : '#000000');
    } else {
       const t = themes[themeName] || themes.blue;
       root.style.setProperty('--accent-bg', t.bg);
       root.style.setProperty('--accent', t.solid);
       root.style.setProperty('--accent-text', '#ffffff');
    }
  }
  
  $('toggle-theme').onclick = () => { 
      document.body.dataset.theme = document.body.dataset.theme === 'light' ? 'dark' : 'light'; 
      updateThemeColors($('theme-color').value); 
  };
  $('theme-color').onchange = (e) => updateThemeColors(e.target.value);

  // --- 3. NAVIGATION ---
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      $(btn.dataset.tab).classList.add('active');
      $(btn.dataset.tab).querySelector('.chip-btn').click();
    };
  });

  document.querySelectorAll('.chip-btn').forEach(b => {
      b.onclick = () => {
         document.querySelectorAll('.chip-btn').forEach(x => x.classList.remove('active'));
         b.classList.add('active');
         document.querySelectorAll('.panel').forEach(p => p.classList.remove('active')); 
         $(b.dataset.panel).classList.add('active');
         // Clock Logic
         if (b.dataset.panel === 'clock-panel') startLiveClock();
         else stopLiveClock();
      }
  });

  // Search
  $('tool-search').addEventListener('input', (e) => {
    const term = e.target.value.toLowerCase();
    if (term.length > 0) {
      document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'block');
      document.querySelector('.tab-bar').style.display = 'none';
      document.querySelectorAll('.chip-btn').forEach(chip => {
        chip.classList.toggle('hidden', !chip.textContent.toLowerCase().includes(term));
      });
    } else {
      document.querySelectorAll('.tab-content').forEach(c => c.style.display = '');
      document.querySelector('.tab-bar').style.display = 'flex';
      document.querySelectorAll('.chip-btn').forEach(c => c.classList.remove('hidden'));
      document.querySelector('.tab-btn.active').click();
    }
  });

  // --- 4. UI SWITCH LOGIC ---
  
  // FD/RD Switch
  $('fd-switch').onclick = function() {
      this.classList.toggle('on');
      isRD = !isRD;
      $('fd-title').textContent = isRD ? "Recurring Deposit" : "Fixed Deposit";
      // Change input label
      document.querySelector('#fd-panel label').textContent = isRD ? "Monthly Deposit" : "Investment Amount";
      // Clear result
      $('fd-res').textContent = "";
  };

  // Clock Sound Switch
  $('clock-switch').onclick = function() {
      this.classList.toggle('on');
      isClockSoundOn = !isClockSoundOn;
      this.querySelector('.sc-label').textContent = isClockSoundOn ? "üîä" : "üîá";
  };

  // Body Fat Gender Toggle (Show/Hide Hip Input)
  $('fat-gender').onchange = (e) => {
      $('fat-hip-group').style.display = e.target.value === 'female' ? 'flex' : 'none';
  };
  /* --- 4. CALCULATOR ENGINE --- */
  
  // Keyboard Support (Fixed)
  document.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;
    const key = e.key;
    if ("0123456789.+-*/%()".includes(key)) {
      e.preventDefault();
      const btn = Array.from(document.querySelectorAll('.btn')).find(b => b.textContent === key || b.textContent === {'*':'√ó', '/':'√∑', '-': '‚àí'}[key]);
      if (btn) btn.click();
      else { expr += key; upd(); }
    }
    else if (key === 'Enter') { e.preventDefault(); $('calc-equals').click(); }
    else if (key === 'Backspace') { e.preventDefault(); $('calc-back').click(); }
    else if (key === 'Escape') { e.preventDefault(); $('calc-clear').click(); }
  });

  const updateHistory = (expression, result) => {
    history.push(`${expression} = ${result}`);
    if (history.length > 3) history.shift(); 
    const tape = $('calc-history');
    tape.innerHTML = history.map(h => `<div class="hist-item">${h}</div>`).join('');
    tape.classList.add('show');
    $('hist-lbl').style.display = 'block'; 
    tape.scrollTop = tape.scrollHeight;
    tape.querySelectorAll('.hist-item').forEach(item => { 
      item.onclick = () => { expr += item.textContent.split('=')[1].trim(); upd(); }; 
    });
  };

  const upd = () => {
      let displayExpr = expr.replace(/\*/g, '√ó').replace(/\//g, '√∑').replace(/Math.PI/g, 'œÄ').replace(/Math.E/g, 'e');
      $('calc-expression').textContent = displayExpr;
  };
  
  const k = ['7','8','9','√∑','4','5','6','√ó','1','2','3','‚àí','0','.','%','+'];
  k.forEach(x => { 
    let b = document.createElement('button'); b.className = 'btn'; b.textContent = x; 
    b.onclick = () => { expr += {'√∑':'/','√ó':'*','‚àí':'-'}[x] || x; upd(); }; 
    $('calc-grid').appendChild(b); 
  });

  const degBtn = $('deg-toggle');
  degBtn.onclick = () => { useDeg = !useDeg; degBtn.textContent = useDeg ? "DEG" : "RAD"; degBtn.classList.toggle('active-mode', useDeg); };
  degBtn.classList.add('active-mode');

  $('sc-switch').onclick = function() { this.classList.toggle('on'); $('sci-keys').style.display = this.classList.contains('on') ? 'grid' : 'none'; };

  document.querySelectorAll('#sci-keys .btn:not(#deg-toggle)').forEach(b => {
    b.onclick = () => { 
      const fn = b.dataset.fn; 
      if (fn === 'pi') expr += 'Math.PI'; else if (fn === 'e') expr += 'Math.E'; else if (fn === 'pow') expr += '**'; 
      else if (fn === 'inv') expr += '1/'; else if (fn === 'sqrt') expr += '‚àö('; else if (fn === '(' || fn === ')') expr += fn;
      else expr += `${fn}(`; 
      upd(); 
    };
  });

  $('calc-back').onclick = () => { 
      if(expr.endsWith('Math.PI')) expr = expr.slice(0, -7); else if(expr.endsWith('Math.E')) expr = expr.slice(0, -6); else expr = expr.slice(0,-1); 
      upd(); 
  };
  $('calc-copy').onclick = () => { navigator.clipboard.writeText($('calc-result').textContent); };
  $('calc-clear').onclick = () => { 
    if (expr === '' && $('calc-result').textContent === '0') { history = []; $('calc-history').innerHTML = ''; $('hist-lbl').style.display = 'none'; } 
    else { expr = ''; upd(); $('calc-result').textContent = '0'; } 
  };

  $('calc-equals').onclick = () => { 
    try { 
      if (!expr) return;
      let s = expr;
      const openCount = (s.match(/\(/g) || []).length;
      const closeCount = (s.match(/\)/g) || []).length;
      if (openCount > closeCount) s += ')'.repeat(openCount - closeCount);

      s = s.replace(/(\d+(\.\d+)?)([\+\-])(\d+(\.\d+)?)%/g, (m,n1,_,op,n2) => {
          const v1 = parseFloat(n1), v2 = parseFloat(n2); return op === '+' ? v1 * (1 + v2/100) : v1 * (1 - v2/100);
      }).replace(/(\d+(\.\d+)?)%/g, '($1/100)');
      
      s = s.replace(/√ó/g,'*').replace(/√∑/g,'/').replace(/‚àí/g,'-').replace(/‚àö\(/g,'Math.sqrt(').replace(/\^/g,'**');

      if (useDeg) {
          const toRad = "(Math.PI/180)*";
          s = s.replace(/sin\(/g, `Math.sin(${toRad}`).replace(/cos\(/g, `Math.cos(${toRad}`).replace(/tan\(/g, `Math.tan(${toRad}`);
      } else {
          s = s.replace(/sin\(/g, 'Math.sin(').replace(/cos\(/g, 'Math.cos(').replace(/tan\(/g, 'Math.tan(');
      }
      s = s.replace(/log\(/g, 'Math.log10(').replace(/ln\(/g, 'Math.log(');

      const raw = eval(s); const res = formatNum(raw);
      if (!isNaN(res) && isFinite(res)) { updateHistory(expr, res); $('calc-result').textContent = res; expr = String(res); } 
      else { $('calc-result').textContent = "Err"; }
    } catch (e) { console.error(e); $('calc-result').textContent = "Err"; } 
  };

  /* --- 5. CLOCK ENGINE --- */
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const playTick = () => {
      if (!isClockSoundOn || audioCtx.state === 'suspended') {
          if(audioCtx.state === 'suspended') audioCtx.resume();
          if(!isClockSoundOn) return;
      }
      const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
      osc.type = 'sine'; osc.frequency.setValueAtTime(1000, audioCtx.currentTime); 
      gain.gain.setValueAtTime(0.05, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
      osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.05);
  };

  const startLiveClock = () => {
      clearInterval(clockInterval);
      const update = () => {
          const now = new Date();
          $('clock-display').textContent = now.toLocaleTimeString('en-US', {hour12: true});
          $('clock-date').textContent = now.toLocaleDateString(undefined, {weekday:'long', year:'numeric', month:'long', day:'numeric'});
          playTick();
      };
      update(); clockInterval = setInterval(update, 1000);
  };
  const stopLiveClock = () => clearInterval(clockInterval);

  // Stopwatch
  const formatTime = (ms) => {
      const min = Math.floor(ms / 60000); const sec = Math.floor((ms % 60000) / 1000); const cent = Math.floor((ms % 1000) / 10);
      return `${pad(min)}:${pad(sec)}.${pad(cent)}`;
  };
  $('sw-start').onclick = function() {
      if (swRunning) { 
          clearInterval(swInterval); this.textContent = "Start"; this.style.backgroundColor = "var(--accent-bg)"; $('sw-lap').textContent = "Reset"; swRunning = false;
      } else { 
          const startTime = Date.now() - swTime;
          swInterval = setInterval(() => { swTime = Date.now() - startTime; $('sw-display').textContent = formatTime(swTime); }, 10);
          this.textContent = "Stop"; this.style.backgroundColor = "#ef4444"; $('sw-lap').textContent = "Lap"; $('sw-lap').disabled = false; swRunning = true;
      }
  };
  $('sw-lap').onclick = function() {
      if (swRunning) { 
          const lap = document.createElement('div'); lap.className = 'lap-item';
          lap.innerHTML = `<span>Lap ${$('sw-laps').children.length + 1}</span><span>${formatTime(swTime)}</span>`;
          $('sw-laps').prepend(lap); $('sw-laps').style.display = 'block';
      } else { 
          swTime = 0; $('sw-display').textContent = "00:00.00"; $('sw-laps').innerHTML = '';
          this.disabled = true; this.textContent = "Lap"; $('sw-start').textContent = "Start"; $('sw-start').style.backgroundColor = "var(--accent-bg)";
      }
  };

  // Timer
  $('t-start').onclick = function() {
      if (timerRunning) { 
          clearInterval(timerInterval); this.textContent = "Start"; this.style.backgroundColor = "var(--accent-bg)"; timerRunning = false;
      } else { 
          if (timerTime <= 0) {
              const h = parseInt($('t-h').value)||0, m = parseInt($('t-m').value)||0, s = parseInt($('t-s').value)||0;
              timerTime = (h*3600) + (m*60) + s; if (timerTime <= 0) return;
              $('timer-inputs').style.display = 'none'; $('t-display').style.display = 'block';
          }
          timerInterval = setInterval(() => {
              timerTime--;
              if (timerTime < 0) {
                  clearInterval(timerInterval); $('t-display').textContent = "Time's Up!";
                  this.textContent = "Start"; this.style.backgroundColor = "var(--accent-bg)"; timerRunning = false;
              } else {
                  $('t-display').textContent = `${pad(Math.floor(timerTime/3600))}:${pad(Math.floor((timerTime%3600)/60))}:${pad(timerTime%60)}`;
              }
          }, 1000);
          this.textContent = "Stop"; this.style.backgroundColor = "#ef4444"; timerRunning = true;
      }
  };
  $('t-reset').onclick = () => {
      clearInterval(timerInterval); timerRunning = false; timerTime = 0;
      $('t-start').textContent = "Start"; $('t-start').style.backgroundColor = "var(--accent-bg)";
      $('t-display').textContent = "00:00:00"; $('t-display').style.display = 'none'; $('timer-inputs').style.display = 'flex';
  };

  /* --- 6. TOOLS LOGIC --- */
  
  // FD/RD Calculator
  $('fd-btn').onclick = () => {
      const p = parseFloat($('fd-amt').value), r = parseFloat($('fd-rate').value), t = parseFloat($('fd-time').value);
      if (!p || !r || !t) { $('fd-res').textContent = "Please fill all fields."; return; }
      let mat = 0, inv = 0;
      if (isRD) { // RD Calculation
          const months = t * 12; const i = r / 1200;
          mat = p * ((Math.pow(1 + i, months) - 1) / i) * (1 + i);
          inv = p * months;
      } else { // FD Calculation (Quarterly Compounding)
          mat = p * Math.pow((1 + (r/100)/4), 4*t);
          inv = p;
      }
      $('fd-res').innerHTML = `Maturity: <b>${globalSym}${formatINR(Math.round(mat))}</b><br><span style="font-size:0.8rem">Invested: ${globalSym}${formatINR(Math.round(inv))} | Profit: ${globalSym}${formatINR(Math.round(mat-inv))}</span>`;
  };

  // Income Tax (Simple Slabs)
  $('tax-btn').onclick = () => {
      const income = parseFloat($('tax-income').value);
      if (!income) { $('tax-res').textContent = "Please enter income."; return; }
      const isNew = document.querySelector('input[name="regime"]:checked').value === 'new';
      let tax = 0;
      if (isNew) { // New Regime FY 23-24
          if (income <= 300000) tax = 0;
          else if (income <= 600000) tax = (income - 300000) * 0.05;
          else if (income <= 900000) tax = 15000 + (income - 600000) * 0.10;
          else if (income <= 1200000) tax = 45000 + (income - 900000) * 0.15;
          else if (income <= 1500000) tax = 90000 + (income - 1200000) * 0.20;
          else tax = 150000 + (income - 1500000) * 0.30;
          if (income <= 700000) tax = 0; // Rebate
      } else { // Old Regime (Approx)
          if (income <= 250000) tax = 0;
          else if (income <= 500000) tax = (income - 250000) * 0.05;
          else if (income <= 1000000) tax = 12500 + (income - 500000) * 0.20;
          else tax = 112500 + (income - 1000000) * 0.30;
          if (income <= 500000) tax = 0; // Rebate
      }
      $('tax-res').innerHTML = `Tax Liability: <b>${globalSym}${formatINR(Math.round(tax))}</b><br><span style="font-size:0.8rem; color:var(--muted)">Disclaimer: Estimated. Consult CA.</span>`;
  };

  // Inflation
  $('inf-btn').onclick = () => {
      const p = parseFloat($('inf-amt').value), r = parseFloat($('inf-rate').value), t = parseFloat($('inf-time').value);
      if (p && r && t) {
          const future = p * Math.pow((1 + r/100), t);
          $('inf-res').innerHTML = `Future Value: <b>${globalSym}${formatINR(Math.round(future))}</b>`;
      }
  };

  // Health
  $('h-btn').onclick = () => {
    const age = parseFloat($('h-age').value), w = parseFloat($('h-weight').value), h = parseFloat($('h-height').value), act = parseFloat($('h-activity').value), gender = $('h-gender').value;
    if (!age || !w || !h) { $('h-msg').textContent = "Please fill all fields"; return; }
    const bmi = (w/((h/100)*(h/100))).toFixed(1);
    let bmr = (10*w) + (6.25*h) - (5*age); bmr = (gender === 'male' ? bmr + 5 : bmr - 161);
    $('h-result').style.display = 'grid';
    $('res-bmi').textContent = bmi; $('res-bmr').textContent = Math.round(bmr * act); 
    $('res-water').textContent = (w/30).toFixed(1); $('res-protein').textContent = Math.round(w * (0.8 + (act - 1.2)));
    $('h-msg').textContent = `Status: ${ bmi < 18.5 ? "Underweight" : bmi < 25 ? "Healthy" : bmi < 30 ? "Overweight" : "Obese" }`;
  };
  
  // Calories (Dedicated)
  $('cal-btn').onclick = () => {
      const age = parseFloat($('cal-age').value), w = parseFloat($('cal-weight').value), h = parseFloat($('cal-height').value), act = parseFloat($('cal-activity').value), gender = $('cal-gender').value;
      if (!age || !w || !h) { $('cal-res').textContent = "Please fill all fields"; return; }
      let bmr = (10*w) + (6.25*h) - (5*age) + (gender === 'male' ? 5 : -161);
      const tdee = Math.round(bmr * act);
      $('cal-res').innerHTML = `Maintain Weight: <b>${tdee} kcal</b><br><span style="font-size:0.8rem">Lose 0.5kg/week: ${tdee - 500} kcal</span>`;
  };

  // Body Fat (US Navy)
  $('fat-btn').onclick = () => {
      const gender = $('fat-gender').value;
      const h = parseFloat($('fat-height').value), waist = parseFloat($('fat-waist').value), neck = parseFloat($('fat-neck').value), hip = parseFloat($('fat-hip').value);
      if(!h || !waist || !neck) { $('fat-res').textContent = "Please fill all fields"; return; }
      let bf = 0;
      if (gender === 'male') {
          bf = 495 / (1.0324 - 0.19077 * Math.log10(waist - neck) + 0.15456 * Math.log10(h)) - 450;
      } else {
          if (!hip) { $('fat-res').textContent = "Hip size required for females."; return; }
          bf = 495 / (1.29579 - 0.35004 * Math.log10(waist + hip - neck) + 0.22100 * Math.log10(h)) - 450;
      }
      $('fat-res').innerHTML = `Body Fat: <b>${bf.toFixed(1)}%</b>`;
  };

  // Travel Budget
  $('tb-btn').onclick = () => {
      const trans = parseFloat($('tb-trans').value)||0, stay = parseFloat($('tb-stay').value)||0, food = parseFloat($('tb-food').value)||0, act = parseFloat($('tb-act').value)||0, misc = parseFloat($('tb-misc').value)||0;
      const total = trans + stay + food + act + misc;
      $('tb-res').innerHTML = `Total Trip Cost: <b>${globalSym}${formatINR(total)}</b>`;
  };

  // Standard Finance Tools
  $('emi-calc').onclick = () => {
    const p = parseFloat($('emi-principal').value), r = parseFloat($('emi-rate').value), t = parseFloat($('emi-time').value), u = $('emi-unit').value;
    if (!p || !r || !t) { $('emi-result').textContent = "Please fill loan amount, rate and tenure."; return; }
    const monthlyRate = r / 1200, n = u === 'years' ? t * 12 : t;
    const emi = (p * monthlyRate * Math.pow(1 + monthlyRate, n)) / (Math.pow(1 + monthlyRate, n) - 1);
    const total = emi * n;
    $('emi-result').innerHTML = `EMI: <b>${globalSym}${formatINR(Math.round(emi))}</b><br><span style="font-size:0.8rem">Total Interest: ${globalSym}${formatINR(Math.round(total - p))}</span>`;
  };
  $('gst-add').onclick = () => calcGST('add'); $('gst-rem').onclick = () => calcGST('remove');
  const calcGST = (m) => {
      const a = parseFloat($('gst-amt').value), r = parseFloat($('gst-rate').value); if(!a||!r)return;
      const n = m=='add' ? a : a/(1+r/100), g = m=='add' ? (a*r/100) : a-n, t = m=='add' ? a+g : a;
      $('gst-res').innerHTML = `Net: ${globalSym}${formatINR(parseFloat(n.toFixed(2)))} | Tax: ${globalSym}${formatINR(parseFloat(g.toFixed(2)))}<br><b>Total: ${globalSym}${formatINR(parseFloat(t.toFixed(2)))}</b>`;
  };
  $('sip-btn').onclick = () => {
     const p = parseFloat($('sip-amt').value), r = parseFloat($('sip-rate').value), y = parseFloat($('sip-years').value);
     const i=r/1200, n=y*12, v = p * ((Math.pow(1+i,n)-1)/i)*(1+i);
     $('sip-res').innerHTML = `Total: <b>${globalSym}${formatINR(Math.round(v))}</b> <span style="font-size:0.8rem">(Profit: ${globalSym}${formatINR(Math.round(v - p*n))})</span>`;
  };
  $('goal-btn').onclick = () => {
    const tg = parseFloat($('goal-target').value), t = parseFloat($('goal-time').value), r = parseFloat($('goal-rate').value);
    const i=r/1200, n=t*12, res = tg / (((Math.pow(1+i,n)-1)/i)*(1+i));
    $('goal-res').innerHTML = `SIP Needed: <b>${globalSym}${formatINR(Math.round(res))}/mo</b>`;
  };
  $('perc-btn').onclick = () => {
    const t = parseFloat($('perc-total').value), r = parseFloat($('perc-rate').value);
    if(t && r) $('perc-res').innerHTML = `${r}% Value: <b>${globalSym}${formatINR((t*r/100).toFixed(2))}</b><br>After Off: <b>${globalSym}${formatINR((t - t*r/100).toFixed(2))}</b>`;
  };
  $('bill-btn').onclick = () => {
    const a = parseFloat($('bill-amt').value), t = parseFloat($('bill-tip').value)||0, p = parseFloat($('bill-ppl').value)||1;
    const tot = a + (a*t/100); $('bill-res').innerHTML = `Total: <b>${globalSym}${formatINR(Math.round(tot))}</b><br>Per Person: <b>${globalSym}${formatINR(Math.round(tot/p))}</b>`;
  };
  $('ci-btn').onclick = () => {
    const p=parseFloat($('ci-p').value), r=parseFloat($('ci-r').value), t=parseFloat($('ci-t').value), n=parseFloat($('ci-n').value);
    const amt = p * Math.pow((1+(r/100)/n),(n*t)); $('ci-res').innerHTML = `Amount: <b>${globalSym}${formatINR(Math.round(amt))}</b><br><span style="font-size:0.8rem">Interest: ${globalSym}${formatINR(Math.round(amt-p))}</span>`;
  };

  // Utilities
  $('fuel-btn').onclick = () => {
    const d=parseFloat($('fuel-dist').value), m=parseFloat($('fuel-mil').value), p=parseFloat($('fuel-price').value);
    $('fuel-res').innerHTML = `Cost: <b>${globalSym}${formatINR(Math.round((d/m)*p))}</b> | Fuel: <b>${(d/m).toFixed(1)} L</b>`;
  };
  $('eta-btn').onclick = () => {
      const d=parseFloat($('eta-dist').value), s=parseFloat($('eta-speed').value), start=$('eta-start').value;
      if(d && s && start) {
        const now=new Date(); const [h,m]=start.split(':'); now.setHours(h); now.setMinutes(m); now.setMinutes(now.getMinutes() + ((d/s)*60));
        $('eta-res').innerHTML = `Arrival: <b>${now.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</b>`;
      }
  };
  $('zone-btn').onclick = () => $('zone-res').textContent = `Time: ${new Date().toLocaleTimeString('en-US',{timeZone:$('zone-sel').value,hour:'2-digit',minute:'2-digit',hour12:true})}`;
  $('qr-btn').onclick = () => { 
    const txt = $('qr-text').value; if (!txt) return; 
    $('qr-container').classList.add('show'); $('qr-image').style.display = 'none'; $('qr-loading').style.display = 'block'; 
    const url = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(txt)}`;
    $('qr-image').onload = () => { 
      $('qr-loading').style.display = 'none'; $('qr-image').style.display = 'block'; 
      fetch(url).then(r=>r.blob()).then(b=>{ $('qr-download').href=URL.createObjectURL(b); $('qr-download').download="qr.png"; $('qr-download').style.display="inline-block"; });
    }; 
    $('qr-image').src = url; 
  };
  $('u-btn').onclick = () => { 
      const v=parseFloat($('u-val').value), type=$('u-type').value, f=$('u-from').value, t=$('u-to').value;
      if(!isNaN(v)) $('u-res').textContent = `${formatNum(uData[type].fn(v, f, t))} ${t}`;
  };
  $('time-diff').onclick = () => { 
    const d1=new Date($('time-start').value), d2=new Date($('time-end').value);
    if(!isNaN(d1)&&!isNaN(d2)) $('time-result').textContent = `${Math.ceil(Math.abs(d2-d1)/8.64e7)} days`;
  };
  $('base-btn').onclick = () => { 
    try { const d = parseInt($('base-num').value, parseInt($('base-from').value)); $('base-res').innerHTML = `DEC: ${d}<br>BIN: ${d.toString(2)}<br>HEX: ${d.toString(16).toUpperCase()}`; } catch { $('base-res').textContent = "Invalid"; } 
  };
  $('gpa-btn').onclick = () => { 
    const n=$('gpa-in').value.split(',').map(Number).filter(x=>!isNaN(x)); 
    $('gpa-res').textContent = "Avg: " + (n.length?(n.reduce((a,b)=>a+b,0)/n.length).toFixed(2):0); 
  };
  
  const txtStats = () => { 
    const v = $('txt-in').value; $('txt-chars').textContent = v.length; $('txt-words').textContent = v.trim().split(/\s+/).filter(w=>w.length>0).length; 
  };
  $('txt-in').oninput = txtStats; $('txt-upper').onclick = () => { $('txt-in').value = $('txt-in').value.toUpperCase(); txtStats(); }; $('txt-lower').onclick = () => { $('txt-in').value = $('txt-in').value.toLowerCase(); txtStats(); }; $('txt-clear').onclick = () => { $('txt-in').value = ''; txtStats(); };

  // Init
  updateThemeColors('mono'); renderUnits();
  document.querySelector('[data-tab="tab-finance"]').click();
</script>
</body>
</html>